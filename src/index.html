<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>TCP/IP å…¨èƒ½æ•™å­¦å®éªŒå®¤</title>
    <style>
        :root { 
            --bg: #0f172a; 
            --panel: #1e293b; 
            --accent: #38bdf8; 
            --text: #f1f5f9; 
            --success: #10b981;
            --danger: #ef4444;
        }
        body { 
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 10px; 
            height: 100vh; 
            box-sizing: border-box; 
            overflow: hidden; 
        }
        
        .main-grid { 
            display: grid; 
            grid-template-columns: 320px 1fr 380px; 
            gap: 12px; 
            height: 100%; 
        }
        
        .glass-panel { 
            background: var(--panel); 
            border-radius: 10px; 
            border: 1px solid #334155; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); 
        }

        h3 { 
            margin: 0 0 10px 0; 
            color: var(--accent); 
            border-bottom: 2px solid #334155; 
            padding-bottom: 8px; 
            font-size: 16px; 
            display: flex; justify-content: space-between; align-items: center;
        }

        /* --- å·¦ä¾§é…ç½® --- */
        .config-scroll { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .input-group { margin-bottom: 10px; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 4px; font-weight: bold; }
        input, select { 
            width: 90%; 
            background: #020617; 
            border: 1px solid #475569; 
            color: white; 
            padding: 8px; 
            border-radius: 4px; 
            font-size: 12px; 
        }
        input:focus { border-color: var(--accent); outline: none; }
        
        .fw-area { 
            background: rgba(239, 68, 68, 0.08); 
            border: 1px dashed var(--danger); 
            padding: 10px; 
            border-radius: 6px; 
            margin-top: 10px; 
        }

        .btn-stack { margin-top: auto; display: flex; flex-direction: column; gap: 8px; }
        button { 
            padding: 12px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 14px; 
            transition: 0.2s; 
            display: flex; justify-content: center; align-items: center; 
        }
        .btn-step { background: #6366f1; color: white; }
        .btn-go { background: var(--success); color: white; }
        button:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }

        /* --- ä¸­é—´èˆå° --- */
        .stage { 
            position: relative; 
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%); 
            border-radius: 10px; 
            border: 2px solid #334155; 
            overflow: hidden; 
        }

        .track-line { position: absolute; top: 75%; left: 10%; width: 80%; height: 2px; background: #334155; z-index: 1; }
        
        .node { 
            position: absolute; top: 75%; transform: translate(-50%, -50%); 
            display: flex; flex-direction: column; align-items: center; z-index: 2; 
        }
        .node-icon { 
            font-size: 32px; background: #0f172a; border: 2px solid var(--accent); border-radius: 50%; 
            width: 50px; height: 50px; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2); margin-bottom: 6px;
        }
        .node span { font-size: 12px; color: #cbd5e1; background: rgba(0,0,0,0.6); padding: 2px 6px; border-radius: 4px; }

        /* æ•°æ®åŒ…æ ·å¼ */
        #packet { 
            position: absolute; left: 15%; top: 10%; 
            width: 240px; 
            transform: translateX(-50%); 
            transition: left 1.2s cubic-bezier(0.25, 1, 0.5, 1), transform 0.5s, opacity 0.5s; 
            z-index: 10;
        }

        .layer-item { 
            background: #334155; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; 
            margin-bottom: 3px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.4); 
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }

        .layer-head { font-size: 13px; font-weight: bold; padding: 6px; text-align: center; color: white; text-shadow: 0 1px 1px rgba(0,0,0,0.5); }
        .layer-body { 
            background: rgba(0,0,0,0.25); padding: 8px; font-family: 'Consolas', monospace; 
            font-size: 11px; color: #e2e8f0; line-height: 1.4; 
        }
        .layer-body span { display: block; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .payload-core { 
            background: #f1f5f9; color: #0f172a; padding: 10px; text-align: center; 
            font-weight: bold; font-size: 14px; border-radius: 4px; border: 2px solid var(--accent);
        }

        /* --- å³ä¾§è¯¦ç»†æ‰‹å†Œ --- */
        .manual-container { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .theory-block { 
            background: #0f172a; margin-bottom: 12px; padding: 12px; 
            border-radius: 8px; border-left: 4px solid #334155; 
            transition: all 0.3s; opacity: 0.6; 
        }
        .theory-active { 
            opacity: 1; border-left-color: var(--accent); 
            background: #1e293b; transform: translateX(5px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .theory-block h4 { margin: 0 0 8px 0; font-size: 14px; color: var(--accent); }
        .theory-tag { 
            display: inline-block; padding: 2px 6px; border-radius: 4px; 
            background: rgba(56, 189, 248, 0.15); color: #bae6fd; 
            font-size: 10px; margin-right: 5px; margin-bottom: 6px; border: 1px solid rgba(56,189,248,0.2);
        }
        .theory-content { font-size: 12px; line-height: 1.6; color: #cbd5e1; }

        #log-window { 
            height: 90px; background: #000; border-radius: 6px; 
            padding: 8px; font-family: monospace; font-size: 11px; 
            color: var(--success); overflow-y: auto; margin-top: 10px; 
        }
    </style>
</head>
<body>

<div class="main-grid">
    
    <div class="glass-panel">
        <h3>é…ç½®ä¸­å¿ƒ (Config)</h3>
        <div class="config-scroll">
            <div class="input-group">
                <label>1. ä¼ è¾“æ•°æ® (Payload)</label>
                <input type="text" id="in-data" value="GET /index.html">
            </div>
            <div class="input-group">
                <label>2. åº”ç”¨åè®® (L5)</label>
                <select id="in-proto" onchange="autoConfig()">
                    <option value="HTTP">HTTP (Web 80)</option>
                    <option value="HTTPS">HTTPS (Sec 443)</option>
                    <option value="SSH">SSH (Admin 22)</option>
                    <option value="DNS">DNS (Query 53)</option>
                    <option value="FTP">FTP (File 21)</option>
                </select>
            </div>
            <div class="input-group">
                <label>3. ç›®æ ‡ç«¯å£ (Dst Port)</label>
                <input type="number" id="in-dport" value="80">
            </div>
            
            <div class="input-group">
                <label>4. æº IP åœ°å€ (Src IP)</label>
                <input type="text" id="in-sip" value="192.168.1.10">
            </div>

            <div class="input-group">
                <label>5. ç›®æ ‡ IP åœ°å€ (Dst IP)</label>
                <input type="text" id="in-dip" value="8.8.8.8">
            </div>
            
            <div class="input-group">
                <label>6. æº MAC åœ°å€ (Src MAC)</label>
                <input type="text" id="in-mac" value="A1:B2:C3:D4:E5:F6">
            </div>

            <div class="input-group">
                <label>7. ç›®çš„ MAC åœ°å€ (Dst MAC)</label>
                <input type="text" id="in-dmac" value="00:11:22:33:44:55">
            </div>
            
            <div class="fw-area">
                <label style="color:var(--danger)">ğŸ”¥ é˜²ç«å¢™æ‹¦æˆª (Blacklist)</label>
                <input type="text" id="fw-list" value="22, 21" placeholder="ä¾‹å¦‚: 22, 21">
            </div>
        </div>

        <div class="btn-stack">
            <button class="btn-step" id="btn-step" onclick="doStep()">â¬‡ï¸ æ‰§è¡Œä¸‹ä¸€æ­¥å°è£…</button>
            <button class="btn-go" id="btn-go" onclick="startAnim()" disabled>ğŸš€ å‘é€å¹¶åŒå‘é€šä¿¡</button>
            <button style="background:#475569; color:white;" onclick="location.reload()">â†º é‡ç½®</button>
        </div>
    </div>

    <div class="stage">
        <div class="track-line"></div>

        <div class="node" style="left: 15%;"><div class="node-icon">ğŸ’»</div><span>ä¸»æœº</span></div>
        <div class="node" style="left: 40%;"><div class="node-icon">ğŸ”¥</div><span>é˜²ç«å¢™</span></div>
        <div class="node" style="left: 65%;"><div class="node-icon">â™½</div><span>è·¯ç”±å™¨</span></div>
        <div class="node" style="left: 85%;"><div class="node-icon">ğŸ–¥ï¸</div><span>æœåŠ¡å™¨</span></div>

        <div id="packet">
            <div id="packet-stack">
                <div class="payload-core" id="core-display">Payload</div>
            </div>
        </div>
    </div>

    <div class="glass-panel">
        <h3>æ·±åº¦åŸç†æ‰‹å†Œ ğŸ“–</h3>
        <div class="manual-container">
            
            <div class="theory-block" id="doc-4">
                <h4>L5. åº”ç”¨å±‚ (Application)</h4>
                <div>
                    <span class="theory-tag">PDU: Message (æŠ¥æ–‡)</span>
                    <span class="theory-tag">åè®®: HTTP/DNS/SSH</span>
                </div>
                <div class="theory-content">
                    ç›´æ¥ä¸ºç”¨æˆ·æä¾›ç½‘ç»œæœåŠ¡æ¥å£ã€‚å°è£…æ—¶é€šè¿‡åè®®æ ¼å¼å°†æ•°æ®æ ‡å‡†åŒ–ï¼Œç¡®å®šé€šä¿¡æ„å›¾ã€‚
                </div>
            </div>

            <div class="theory-block" id="doc-3">
                <h4>L4. ä¼ è¾“å±‚ (Transport)</h4>
                <div>
                    <span class="theory-tag">PDU: Segment (æ®µ)</span>
                    <span class="theory-tag">ç¡¬ä»¶: é˜²ç«å¢™(æŸ¥ç«¯å£)</span>
                </div>
                <div class="theory-content">
                    æ ¸å¿ƒä»»åŠ¡æ˜¯<b>ç«¯åˆ°ç«¯</b>é€šä¿¡ã€‚é€šè¿‡<b>ç«¯å£å·</b>åŒºåˆ†è¿›ç¨‹ã€‚TCP æä¾›å¯é ä¼ è¾“ï¼ŒUDP æä¾›å¿«é€Ÿä¼ è¾“ã€‚
                </div>
            </div>

            <div class="theory-block" id="doc-2">
                <h4>L3. ç½‘ç»œå±‚ (Network)</h4>
                <div>
                    <span class="theory-tag">PDU: Packet (åŒ…)</span>
                    <span class="theory-tag">ç¡¬ä»¶: è·¯ç”±å™¨</span>
                </div>
                <div class="theory-content">
                    æ ¸å¿ƒä»»åŠ¡æ˜¯<b>é€»è¾‘å¯»å€</b>ã€‚IP åè®®æ ¹æ® IP åœ°å€åœ¨äº’è”ç½‘ä¸­å¯»æ‰¾è·¯å¾„ï¼ŒåŒ…å«<b>æº IP</b> å’Œ<b>ç›®çš„ IP</b>ã€‚
                </div>
            </div>

            <div class="theory-block" id="doc-1">
                <h4>L2. æ•°æ®é“¾è·¯å±‚ (Data Link)</h4>
                <div>
                    <span class="theory-tag">PDU: Frame (å¸§)</span>
                    <span class="theory-tag">ç¡¬ä»¶: äº¤æ¢æœº/ç½‘å¡</span>
                </div>
                <div class="theory-content">
                    æ ¸å¿ƒä»»åŠ¡æ˜¯<b>ç‰©ç†åœ°å€å¯»å€</b>ã€‚åˆ©ç”¨ <b>MAC åœ°å€</b> åœ¨å±€åŸŸç½‘å†…ä¼ è¾“æ•°æ®ï¼ŒåŒ…å«<b>æº MAC</b> å’Œ<b>ç›®çš„ MAC</b>ã€‚
                </div>
            </div>

            <div class="theory-block" id="doc-0">
                <h4>L1. ç‰©ç†å±‚ (Physical)</h4>
                <div>
                    <span class="theory-tag">æ•°æ®: Bits (æ¯”ç‰¹æµ)</span>
                    <span class="theory-tag">ä»‹è´¨: å…‰çº¤/åŒç»çº¿</span>
                </div>
                <div class="theory-content">
                    å°†é€»è¾‘å¸§è½¬æ¢ä¸ºåŸå§‹çš„<b>æ¯”ç‰¹æµ (0101)</b>ã€‚å®šä¹‰äº†ç”µå‹ã€æ¥å£æ ‡å‡†åŠä¼ è¾“ä»‹è´¨ç‰©ç†å±æ€§ã€‚
                </div>
            </div>

        </div>
        <div id="log-window">> å‡†å¤‡å°±ç»ª...</div>
    </div>
</div>

<script>
    let step = 0;
    const layers = [
        { name: 'PHY ç‰©ç†å±‚', color: '#64748b' },
        { name: 'LINK é“¾è·¯å±‚', color: '#10b981' },
        { name: 'NET ç½‘ç»œå±‚', color: '#f59e0b' },
        { name: 'TRANS ä¼ è¾“å±‚', color: '#8b5cf6' },
        { name: 'APP åº”ç”¨å±‚', color: '#3b82f6' }
    ];

    function autoConfig() {
        const proto = document.getElementById('in-proto').value;
        const ports = { 'HTTP': 80, 'HTTPS': 443, 'SSH': 22, 'DNS': 53, 'FTP': 21 };
        document.getElementById('in-dport').value = ports[proto];
        log(`åè®®è®¾ä¸º ${proto}ï¼Œé¢„è®¾ç«¯å£ ${ports[proto]}`);
    }

    function doStep() {
        if (step >= 5) return;
        const idx = 4 - step; 
        const config = layers[idx];
        const stack = document.getElementById('packet-stack');

        let info = "";
        if(idx === 4) info = `Proto: ${document.getElementById('in-proto').value} | Len: ${document.getElementById('in-data').value.length}`;
        else if(idx === 3) info = `DstPort: ${document.getElementById('in-dport').value} | SrcPort: 51234`;
        else if(idx === 2) {
            const sip = document.getElementById('in-sip').value;
            const dip = document.getElementById('in-dip').value;
            info = `SrcIP: ${sip} | DstIP: ${dip}`;
        }
        else if(idx === 1) {
            const sMac = document.getElementById('in-mac').value;
            const dMac = document.getElementById('in-dmac').value; // è¯»å–è‡ªå®šä¹‰ç›®çš„MAC
            info = `Src: ${sMac} | Dst: ${dMac}`;
        }
        else info = `Bits: 01011101... | Signal: 3.3V`;

        const div = document.createElement('div');
        div.className = 'layer-item';
        div.style.background = config.color;
        div.innerHTML = `<div class="layer-head">${config.name}</div><div class="layer-body"><span>${info.split('|')[0]}</span><span>${info.split('|')[1]||''}</span></div>`;
        stack.insertBefore(div, stack.firstChild);

        document.querySelectorAll('.theory-block').forEach(b => b.classList.remove('theory-active'));
        const doc = document.getElementById(`doc-${idx}`);
        doc.classList.add('theory-active');
        doc.scrollIntoView({ behavior: 'smooth', block: 'center' });

        log(`å°è£…å®Œæˆ: ${config.name}`);
        step++;

        if(step === 5) {
            document.getElementById('btn-step').disabled = true;
            document.getElementById('btn-go').disabled = false;
        }
    }

    async function startAnim() {
        const p = document.getElementById('packet');
        const dport = document.getElementById('in-dport').value;
        const blockList = document.getElementById('fw-list').value.split(',').map(x=>x.trim());

        log("å¼€å§‹ä¼ è¾“ -> å‰å¾€é˜²ç«å¢™...");
        p.style.left = "40%";
        await wait(1500);

        if(blockList.includes(dport)) {
            log(`[æ‹¦æˆª] ç«¯å£ ${dport} å‘½ä¸­é»‘åå•ï¼`, 'error');
            p.style.transform = "translateX(-50%) translateY(100px) scale(0)";
            p.style.opacity = "0";
            return;
        }

        log("é˜²ç«å¢™æ”¾è¡Œã€‚å‰å¾€è·¯ç”±å™¨...");
        p.style.left = "65%";
        await wait(1200);

        log("è·¯ç”±è½¬å‘ -> æœåŠ¡å™¨...");
        p.style.left = "85%";
        await wait(1200);

        log("æœåŠ¡å™¨å¤„ç†å®Œæ¯•ï¼Œå‘é€ ACK...", 'success');
        document.getElementById('packet-stack').innerHTML = `<div class="payload-core" style="background:#10b981; color:white; border-color:white;">ACK: 200 OK</div>`;
        p.style.left = "15%"; 
    }

    function log(msg, type) {
        const win = document.getElementById('log-window');
        const color = type==='error'?'#ef4444':(type==='success'?'#10b981':'#38bdf8');
        win.innerHTML = `<div style="color:${color}">> ${msg}</div>` + win.innerHTML;
    }
    function wait(ms) { return new Promise(r=>setTimeout(r,ms)); }
    
    document.getElementById('in-data').addEventListener('input', e => document.getElementById('core-display').innerText = e.target.value || "Payload");
</script>
</body>
</html>